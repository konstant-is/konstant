{"version":3,"sources":["../../src/components/createTranslationContext.tsx"],"sourcesContent":["'use client'\n\nimport type { PropsWithChildren } from 'react'\n\nimport React, { createContext, useCallback, useContext, useEffect, useRef, useState } from 'react'\n\nimport type {\n  InferTranslationKeys,\n  InferTranslationLocales,\n  TranslationContextValue,\n} from '../types.js'\n\nimport { createTranslation, entriesOf } from '../lib/utils.js'\n\n// ---- helpers shared by all instances ----\n\nfunction useMounted(): () => boolean {\n  const isMounted = useRef(false)\n\n  useEffect(() => {\n    isMounted.current = true\n    return () => {\n      isMounted.current = false\n    }\n  }, [])\n\n  return useCallback(() => isMounted.current, [])\n}\n\nexport function createTranslationContext<T>() {\n  return createContext<\n    TranslationContextValue<InferTranslationLocales<T>, InferTranslationKeys<T>> | undefined\n  >(undefined)\n}\n\nexport type ProviderProps<T> = React.PropsWithChildren<{\n  config: T\n  locale: string\n}>\n\nexport function createTranslationProvider<T>(\n  TranslationContext: React.Context<\n    TranslationContextValue<InferTranslationLocales<T>, InferTranslationKeys<T>> | undefined\n  >,\n) {\n  type L = InferTranslationLocales<T>\n  type K = InferTranslationKeys<T>\n\n  return function TranslationProvider({\n    children,\n    config,\n    locale: initialLocale,\n  }: PropsWithChildren<{\n    config: T\n    locale: string\n  }>) {\n    const isMounted = useMounted()\n\n    const [currentLocale, setLocale] = useState<string>(initialLocale)\n    const [attributes, setAttributes] = useState<Record<string, string>>({\n      locale: initialLocale,\n    })\n\n    useEffect(() => {\n      setLocale(initialLocale)\n    }, [initialLocale])\n\n    const updateAttributes = useCallback(\n      (values: Record<string, string>) => {\n        setAttributes({\n          locale: currentLocale,\n          ...values,\n        })\n      },\n      [currentLocale],\n    )\n\n    const renderAttributes = () =>\n      Object.entries(attributes).reduce(\n        (acc, [key, value]) => {\n          acc[`data-${key}`] = value\n          return acc\n        },\n        {} as Record<string, string>,\n      )\n\n    const t = createTranslation(currentLocale, config)\n\n    const value: TranslationContextValue<L, K> = {\n      attributes,\n      currentLocale,\n      defaultLocale: (config as any).defaultLocale,\n      isMounted,\n      locales: Object.entries((config as any).locales).map(([code, label]) => ({\n        code,\n        label: label as string,\n      })),\n      setAttributes: updateAttributes,\n      setLocale,\n      t,\n    }\n\n    return (\n      <TranslationContext.Provider value={value}>\n        {children}\n        <div id=\"lang\" {...renderAttributes()} />\n      </TranslationContext.Provider>\n    )\n  }\n}\n\nexport function createUseTranslation<T>(\n  TranslationContext: React.Context<\n    TranslationContextValue<InferTranslationLocales<T>, InferTranslationKeys<T>> | undefined\n  >,\n) {\n  return function useTranslation() {\n    const ctx = useContext(TranslationContext)\n    if (!ctx) {\n      throw new Error('useTranslation must be used within a TranslationProvider')\n    }\n    return ctx\n  }\n}\n\nexport function typedEntries<T extends Record<string, string>>(obj: T) {\n  return Object.entries(obj) as [keyof T & string, string][]\n}\n"],"names":["React","createContext","useCallback","useContext","useEffect","useRef","useState","createTranslation","useMounted","isMounted","current","createTranslationContext","undefined","createTranslationProvider","TranslationContext","TranslationProvider","children","config","locale","initialLocale","currentLocale","setLocale","attributes","setAttributes","updateAttributes","values","renderAttributes","Object","entries","reduce","acc","key","value","t","defaultLocale","locales","map","code","label","Provider","div","id","createUseTranslation","useTranslation","ctx","Error","typedEntries","obj"],"mappings":"AAAA;;AAIA,OAAOA,SAASC,aAAa,EAAEC,WAAW,EAAEC,UAAU,EAAEC,SAAS,EAAEC,MAAM,EAAEC,QAAQ,QAAQ,QAAO;AAQlG,SAASC,iBAAiB,QAAmB,kBAAiB;AAE9D,4CAA4C;AAE5C,SAASC;IACP,MAAMC,YAAYJ,OAAO;IAEzBD,UAAU;QACRK,UAAUC,OAAO,GAAG;QACpB,OAAO;YACLD,UAAUC,OAAO,GAAG;QACtB;IACF,GAAG,EAAE;IAEL,OAAOR,YAAY,IAAMO,UAAUC,OAAO,EAAE,EAAE;AAChD;AAEA,OAAO,SAASC;IACd,qBAAOV,cAELW;AACJ;AAOA,OAAO,SAASC,0BACdC,kBAEC;IAKD,OAAO,SAASC,oBAAoB,EAClCC,QAAQ,EACRC,MAAM,EACNC,QAAQC,aAAa,EAIrB;QACA,MAAMV,YAAYD;QAElB,MAAM,CAACY,eAAeC,UAAU,GAAGf,SAAiBa;QACpD,MAAM,CAACG,YAAYC,cAAc,GAAGjB,SAAiC;YACnEY,QAAQC;QACV;QAEAf,UAAU;YACRiB,UAAUF;QACZ,GAAG;YAACA;SAAc;QAElB,MAAMK,mBAAmBtB,YACvB,CAACuB;YACCF,cAAc;gBACZL,QAAQE;gBACR,GAAGK,MAAM;YACX;QACF,GACA;YAACL;SAAc;QAGjB,MAAMM,mBAAmB,IACvBC,OAAOC,OAAO,CAACN,YAAYO,MAAM,CAC/B,CAACC,KAAK,CAACC,KAAKC,MAAM;gBAChBF,GAAG,CAAC,CAAC,KAAK,EAAEC,KAAK,CAAC,GAAGC;gBACrB,OAAOF;YACT,GACA,CAAC;QAGL,MAAMG,IAAI1B,kBAAkBa,eAAeH;QAE3C,MAAMe,QAAuC;YAC3CV;YACAF;YACAc,eAAe,AAACjB,OAAeiB,aAAa;YAC5CzB;YACA0B,SAASR,OAAOC,OAAO,CAAC,AAACX,OAAekB,OAAO,EAAEC,GAAG,CAAC,CAAC,CAACC,MAAMC,MAAM,GAAM,CAAA;oBACvED;oBACAC,OAAOA;gBACT,CAAA;YACAf,eAAeC;YACfH;YACAY;QACF;QAEA,qBACE,MAACnB,mBAAmByB,QAAQ;YAACP,OAAOA;;gBACjChB;8BACD,KAACwB;oBAAIC,IAAG;oBAAQ,GAAGf,kBAAkB;;;;IAG3C;AACF;AAEA,OAAO,SAASgB,qBACd5B,kBAEC;IAED,OAAO,SAAS6B;QACd,MAAMC,MAAMzC,WAAWW;QACvB,IAAI,CAAC8B,KAAK;YACR,MAAM,IAAIC,MAAM;QAClB;QACA,OAAOD;IACT;AACF;AAEA,OAAO,SAASE,aAA+CC,GAAM;IACnE,OAAOpB,OAAOC,OAAO,CAACmB;AACxB"}