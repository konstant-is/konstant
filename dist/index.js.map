{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import type { Config, Field, GlobalConfig, LocalizationConfig } from 'payload'\n\ntype TranslationPluginConfig = {\n  admin?: GlobalConfig['admin']\n  // defaultLocale: string\n  hooks?: GlobalConfig['hooks']\n  // locales: string[]\n  slug?: string\n  translations?: Record<string, Record<string, string>>\n}\n\nexport const translationPlugin =\n  (pluginOptions: TranslationPluginConfig) =>\n  (incomingConfig: Config): Config => {\n    // create copy of incoming config\n    const config = { ...incomingConfig }\n\n    if (!incomingConfig.localization) {\n      return config\n    }\n\n    config.globals = [\n      ...(config.globals || []),\n      ...translationGlobal(pluginOptions, incomingConfig),\n    ]\n    return config\n  }\n\nconst translationGlobal = (opts: TranslationPluginConfig, config: Config): GlobalConfig[] => {\n  const localizations = getLocalization(config.localization)\n  if (!localizations) {\n    return []\n  }\n  return [\n    {\n      slug: 'translations',\n      admin: opts.admin,\n      fields: [\n        {\n          name: 'locales',\n          type: 'group',\n          fields: getLocales(localizations).map((value) => {\n            return {\n              name: value,\n              type: 'text',\n              defaultValue: value,\n              required: true,\n            }\n          }),\n        },\n        {\n          name: 'defaultLocale',\n          type: 'select',\n          defaultValue: localizations.defaultLocale,\n          options: getLocales(localizations),\n          required: true,\n        },\n        {\n          name: 'translations',\n          type: 'group',\n          fields: Object.keys(opts.translations ?? {}).map((key) => ({\n            type: 'collapsible',\n            admin: {\n              initCollapsed: true,\n            },\n            fields: [\n              {\n                name: key,\n                type: 'group',\n                admin: {\n                  hideGutter: true,\n                },\n                fields: translationField(key, opts.translations ?? {}),\n                label: key.charAt(0).toUpperCase() + key.slice(1), // Capitalize the key for the label\n              },\n            ],\n            label: key.charAt(0).toUpperCase() + key.slice(1), // Capitalize the key for the label\n          })),\n        },\n      ],\n      hooks: opts.hooks,\n    },\n  ]\n}\n\nconst getLocalization = (localization: Config['localization']) => {\n  return !localization ? null : localization\n}\n\nconst getLocales = (localization: LocalizationConfig) => {\n  return localization.locales.map((locale) => {\n    return typeof locale === 'string' ? locale : locale.code\n  })\n}\n\nconst translationField = (\n  key: string,\n  translations: Record<string, Record<string, string>>,\n): Field[] => {\n  const translation = translations[key]\n\n  if (!translation) {\n    throw new Error(`Translation key \"${key}\" does not exist in translations.`)\n  }\n\n  const fields: Field[] = [\n    {\n      name: 'key',\n      type: 'text',\n      admin: {\n        readOnly: true,\n      },\n      defaultValue: key,\n      hooks: {\n        beforeChange: [\n          ({ value }) => {\n            // Always enforce the original key value\n            return key\n          },\n        ],\n      },\n      label: 'Translation Key',\n      required: true,\n    },\n\n    ...Object.keys(translation).map((locale) => {\n      const value = translation[locale]\n      const field: Field = {\n        name: locale,\n        type: 'textarea',\n        defaultValue: value ?? undefined,\n        hooks: {\n          beforeValidate: [\n            (data) => {\n              return data.value || value\n            },\n          ],\n        },\n        label: `${locale.toUpperCase()}`,\n      }\n      return field\n    }),\n  ]\n\n  return fields\n}\n"],"names":["translationPlugin","pluginOptions","incomingConfig","config","localization","globals","translationGlobal","opts","localizations","getLocalization","slug","admin","fields","name","type","getLocales","map","value","defaultValue","required","defaultLocale","options","Object","keys","translations","key","initCollapsed","hideGutter","translationField","label","charAt","toUpperCase","slice","hooks","locales","locale","code","translation","Error","readOnly","beforeChange","field","undefined","beforeValidate","data"],"mappings":"AAWA,OAAO,MAAMA,oBACX,CAACC,gBACD,CAACC;QACC,iCAAiC;QACjC,MAAMC,SAAS;YAAE,GAAGD,cAAc;QAAC;QAEnC,IAAI,CAACA,eAAeE,YAAY,EAAE;YAChC,OAAOD;QACT;QAEAA,OAAOE,OAAO,GAAG;eACXF,OAAOE,OAAO,IAAI,EAAE;eACrBC,kBAAkBL,eAAeC;SACrC;QACD,OAAOC;IACT,EAAC;AAEH,MAAMG,oBAAoB,CAACC,MAA+BJ;IACxD,MAAMK,gBAAgBC,gBAAgBN,OAAOC,YAAY;IACzD,IAAI,CAACI,eAAe;QAClB,OAAO,EAAE;IACX;IACA,OAAO;QACL;YACEE,MAAM;YACNC,OAAOJ,KAAKI,KAAK;YACjBC,QAAQ;gBACN;oBACEC,MAAM;oBACNC,MAAM;oBACNF,QAAQG,WAAWP,eAAeQ,GAAG,CAAC,CAACC;wBACrC,OAAO;4BACLJ,MAAMI;4BACNH,MAAM;4BACNI,cAAcD;4BACdE,UAAU;wBACZ;oBACF;gBACF;gBACA;oBACEN,MAAM;oBACNC,MAAM;oBACNI,cAAcV,cAAcY,aAAa;oBACzCC,SAASN,WAAWP;oBACpBW,UAAU;gBACZ;gBACA;oBACEN,MAAM;oBACNC,MAAM;oBACNF,QAAQU,OAAOC,IAAI,CAAChB,KAAKiB,YAAY,IAAI,CAAC,GAAGR,GAAG,CAAC,CAACS,MAAS,CAAA;4BACzDX,MAAM;4BACNH,OAAO;gCACLe,eAAe;4BACjB;4BACAd,QAAQ;gCACN;oCACEC,MAAMY;oCACNX,MAAM;oCACNH,OAAO;wCACLgB,YAAY;oCACd;oCACAf,QAAQgB,iBAAiBH,KAAKlB,KAAKiB,YAAY,IAAI,CAAC;oCACpDK,OAAOJ,IAAIK,MAAM,CAAC,GAAGC,WAAW,KAAKN,IAAIO,KAAK,CAAC;gCACjD;6BACD;4BACDH,OAAOJ,IAAIK,MAAM,CAAC,GAAGC,WAAW,KAAKN,IAAIO,KAAK,CAAC;wBACjD,CAAA;gBACF;aACD;YACDC,OAAO1B,KAAK0B,KAAK;QACnB;KACD;AACH;AAEA,MAAMxB,kBAAkB,CAACL;IACvB,OAAO,CAACA,eAAe,OAAOA;AAChC;AAEA,MAAMW,aAAa,CAACX;IAClB,OAAOA,aAAa8B,OAAO,CAAClB,GAAG,CAAC,CAACmB;QAC/B,OAAO,OAAOA,WAAW,WAAWA,SAASA,OAAOC,IAAI;IAC1D;AACF;AAEA,MAAMR,mBAAmB,CACvBH,KACAD;IAEA,MAAMa,cAAcb,YAAY,CAACC,IAAI;IAErC,IAAI,CAACY,aAAa;QAChB,MAAM,IAAIC,MAAM,CAAC,iBAAiB,EAAEb,IAAI,iCAAiC,CAAC;IAC5E;IAEA,MAAMb,SAAkB;QACtB;YACEC,MAAM;YACNC,MAAM;YACNH,OAAO;gBACL4B,UAAU;YACZ;YACArB,cAAcO;YACdQ,OAAO;gBACLO,cAAc;oBACZ,CAAC,EAAEvB,KAAK,EAAE;wBACR,wCAAwC;wBACxC,OAAOQ;oBACT;iBACD;YACH;YACAI,OAAO;YACPV,UAAU;QACZ;WAEGG,OAAOC,IAAI,CAACc,aAAarB,GAAG,CAAC,CAACmB;YAC/B,MAAMlB,QAAQoB,WAAW,CAACF,OAAO;YACjC,MAAMM,QAAe;gBACnB5B,MAAMsB;gBACNrB,MAAM;gBACNI,cAAcD,SAASyB;gBACvBT,OAAO;oBACLU,gBAAgB;wBACd,CAACC;4BACC,OAAOA,KAAK3B,KAAK,IAAIA;wBACvB;qBACD;gBACH;gBACAY,OAAO,GAAGM,OAAOJ,WAAW,IAAI;YAClC;YACA,OAAOU;QACT;KACD;IAED,OAAO7B;AACT"}