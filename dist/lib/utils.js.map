{"version":3,"sources":["../../src/lib/utils.ts"],"sourcesContent":["import type {\n  InferTranslationKeys,\n  InferTranslationLocales,\n  TranslationConfig,\n  TranslationFn,\n  TranslationKey,\n} from '../types.js'\n\nlet locales: string[] = []\nlet defaultLocale: string = ''\ntype Locale<L extends string, K extends string> = TranslationConfig<L, K>['defaultLocale']\n\nexport const setLocales = <L extends string, K extends string>(config: TranslationConfig<L, K>) => {\n  locales = Object.keys(config.locales)\n  defaultLocale = config.defaultLocale\n}\n/**\n * Checks if a given string is a valid locale.\n * @param locale The locale string to validate.\n * @returns The validated locale if valid, otherwise throws an error.\n */\nexport const isLocale = (locale: string): boolean => {\n  if ((locales as readonly string[]).includes(locale)) {\n    return true\n  }\n\n  return false\n}\n\n/**\n * Validates and returns the locale.\n * @param locale The locale string to validate.\n * @returns The validated locale.\n */\nexport const getLocale = <L extends string, K extends string>(\n  locale = defaultLocale,\n): Locale<L, K> => {\n  if (isLocale(locale)) {\n    return locale as Locale<L, K>\n  } else {\n    console.error(\n      `Invalid locale \"${locale}\" received. Falling back to default locale \"${defaultLocale}\".`,\n    )\n    return defaultLocale as Locale<L, K> // Fallback to default locale\n  }\n}\n\n/**\n * Replaces placeholders (e.g., ${count}) in translation strings.\n */\nconst replaceParams = (template: string, params: Record<string, any> = {}) =>\n  Object.entries(params).reduce(\n    (result, [key, value]) => result.replace(`\\${${key}}`, String(value)),\n    template,\n  )\n\n/**\n * Creates a translation function (`t`) from a dictionary.\n * This function can be used both on the server and in a client provider.\n */\nexport function createTranslation<T>(\n  locale: string,\n  config: T,\n): TranslationFn<InferTranslationLocales<T>, InferTranslationKeys<T>> {\n  type L = InferTranslationLocales<T>\n  type K = InferTranslationKeys<T>\n\n  return (key: K, params?: Record<string, any>): string => {\n    const entry = (config as any).translations[key]\n    if (!entry) {\n      return String(key)\n    }\n\n    const raw = entry[locale] ?? entry[(config as any).defaultLocale] ?? entry.key\n\n    return params ? replaceParams(raw) : raw\n  }\n}\n\n// export const createTranslationDepricated = <L extends string, K extends string>(\n//   locale: string,\n//   config: TranslationConfig<L, K>,\n// ) => {\n//   return (key: TranslationKey<L, K>, params?: Record<string, any>) =>\n//     getTranslation({ config, key, locale, params })\n// }\n\n/**\n * Retrieves a translation with optional parameter replacement.\n */\nconst getTranslation = <L extends string, K extends string>({\n  config,\n  key,\n  locale,\n  params,\n}: {\n  config: TranslationConfig<L, K>\n  key: TranslationKey<L, K>\n  locale: string\n  params?: Record<string, any>\n}): string => {\n  const entry = config.translations[key] as\n    | {\n        [locale: string]: null | string | undefined\n        key: string\n      }\n    | undefined\n\n  if (!entry) {\n    return key\n  }\n  const template = entry[locale]\n\n  return template ? replaceParams(template, params) : key\n}\n\nexport function entriesOf<T extends Record<string, any>>(obj: T) {\n  return Object.entries(obj) as [keyof T, T[keyof T]][]\n}\n"],"names":["locales","defaultLocale","setLocales","config","Object","keys","isLocale","locale","includes","getLocale","console","error","replaceParams","template","params","entries","reduce","result","key","value","replace","String","createTranslation","entry","translations","raw","getTranslation","entriesOf","obj"],"mappings":"AAQA,IAAIA,UAAoB,EAAE;AAC1B,IAAIC,gBAAwB;AAG5B,OAAO,MAAMC,aAAa,CAAqCC;IAC7DH,UAAUI,OAAOC,IAAI,CAACF,OAAOH,OAAO;IACpCC,gBAAgBE,OAAOF,aAAa;AACtC,EAAC;AACD;;;;CAIC,GACD,OAAO,MAAMK,WAAW,CAACC;IACvB,IAAI,AAACP,QAA8BQ,QAAQ,CAACD,SAAS;QACnD,OAAO;IACT;IAEA,OAAO;AACT,EAAC;AAED;;;;CAIC,GACD,OAAO,MAAME,YAAY,CACvBF,SAASN,aAAa;IAEtB,IAAIK,SAASC,SAAS;QACpB,OAAOA;IACT,OAAO;QACLG,QAAQC,KAAK,CACX,CAAC,gBAAgB,EAAEJ,OAAO,4CAA4C,EAAEN,cAAc,EAAE,CAAC;QAE3F,OAAOA;IAA8B,6BAA6B;IACpE;AACF,EAAC;AAED;;CAEC,GACD,MAAMW,gBAAgB,CAACC,UAAkBC,SAA8B,CAAC,CAAC,GACvEV,OAAOW,OAAO,CAACD,QAAQE,MAAM,CAC3B,CAACC,QAAQ,CAACC,KAAKC,MAAM,GAAKF,OAAOG,OAAO,CAAC,CAAC,GAAG,EAAEF,IAAI,CAAC,CAAC,EAAEG,OAAOF,SAC9DN;AAGJ;;;CAGC,GACD,OAAO,SAASS,kBACdf,MAAc,EACdJ,MAAS;IAKT,OAAO,CAACe,KAAQJ;QACd,MAAMS,QAAQ,AAACpB,OAAeqB,YAAY,CAACN,IAAI;QAC/C,IAAI,CAACK,OAAO;YACV,OAAOF,OAAOH;QAChB;QAEA,MAAMO,MAAMF,KAAK,CAAChB,OAAO,IAAIgB,KAAK,CAAC,AAACpB,OAAeF,aAAa,CAAC,IAAIsB,MAAML,GAAG;QAE9E,OAAOJ,SAASF,cAAca,OAAOA;IACvC;AACF;AAEA,mFAAmF;AACnF,oBAAoB;AACpB,qCAAqC;AACrC,SAAS;AACT,wEAAwE;AACxE,sDAAsD;AACtD,IAAI;AAEJ;;CAEC,GACD,MAAMC,iBAAiB,CAAqC,EAC1DvB,MAAM,EACNe,GAAG,EACHX,MAAM,EACNO,MAAM,EAMP;IACC,MAAMS,QAAQpB,OAAOqB,YAAY,CAACN,IAAI;IAOtC,IAAI,CAACK,OAAO;QACV,OAAOL;IACT;IACA,MAAML,WAAWU,KAAK,CAAChB,OAAO;IAE9B,OAAOM,WAAWD,cAAcC,UAAUC,UAAUI;AACtD;AAEA,OAAO,SAASS,UAAyCC,GAAM;IAC7D,OAAOxB,OAAOW,OAAO,CAACa;AACxB"}