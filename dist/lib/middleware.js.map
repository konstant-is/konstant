{"version":3,"sources":["../../src/lib/middleware.ts"],"sourcesContent":["import type { NextRequest } from 'next/server.js'\n\nimport { NextResponse } from 'next/server.js'\n\nconst bypass = [\n  '/admin',\n  '/api',\n  '/_next',\n  '/static',\n  '/favicon.ico',\n  '/sitemap.xml',\n  '/robots.txt',\n  '/.well-known',\n  '/static',\n]\n\nexport function createLocalizationMiddleware(opts: {\n  config: { defaultLocale: string; locales: string[] }\n  log?: boolean\n}) {\n  const { config, log: logEnabled = false } = opts\n  const log = (...params: any) => {\n    if (logEnabled) {\n      console.log(`[Localization middleware] `, ...params)\n    }\n  }\n  return function middleware(request: NextRequest): NextResponse | undefined {\n    const { pathname } = request.nextUrl\n\n    if (shouldBypass(pathname) || pathname === undefined) {\n      log(`bypassing ${pathname}`)\n      return NextResponse.next()\n    }\n\n    // 1. Split into parts\n    const parts = pathname.split('/').filter(Boolean) // e.g. /about → [\"about\"], /is/about → [\"is\",\"about\"]\n\n    // 2. If no locale in path, rewrite to default locale\n    if (!parts.length || !config.locales.includes(parts[0])) {\n      log(` No locale in path, rewrite to default locale ${config.defaultLocale}`)\n      const newUrl = new URL(`/${config.defaultLocale}${pathname}`, request.url)\n      newUrl.search = request.nextUrl.search // ✅ Preserve query params\n      return NextResponse.rewrite(newUrl)\n    }\n\n    const locale = parts[0]\n\n    // 3. If default locale is in path → rewrite to drop it in the browser\n    if (locale === config.defaultLocale) {\n      log(`default locale is in path → rewrite to drop it in the browser`)\n      const newUrl = new URL('/' + parts.slice(1).join('/'), request.url)\n      newUrl.search = request.nextUrl.search // ✅ Preserve query params\n      return NextResponse.redirect(newUrl)\n    }\n\n    // 4. Non-default locales → keep as-is\n    return NextResponse.next()\n  }\n}\n\n// ---------- Helpers ----------\n\nconst shouldBypass = (pathname: string): boolean => bypass.some((path) => pathname.startsWith(path))\n"],"names":["NextResponse","bypass","createLocalizationMiddleware","opts","config","log","logEnabled","params","console","middleware","request","pathname","nextUrl","shouldBypass","undefined","next","parts","split","filter","Boolean","length","locales","includes","defaultLocale","newUrl","URL","url","search","rewrite","locale","slice","join","redirect","some","path","startsWith"],"mappings":"AAEA,SAASA,YAAY,QAAQ,iBAAgB;AAE7C,MAAMC,SAAS;IACb;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAED,OAAO,SAASC,6BAA6BC,IAG5C;IACC,MAAM,EAAEC,MAAM,EAAEC,KAAKC,aAAa,KAAK,EAAE,GAAGH;IAC5C,MAAME,MAAM,CAAC,GAAGE;QACd,IAAID,YAAY;YACdE,QAAQH,GAAG,CAAC,CAAC,0BAA0B,CAAC,KAAKE;QAC/C;IACF;IACA,OAAO,SAASE,WAAWC,OAAoB;QAC7C,MAAM,EAAEC,QAAQ,EAAE,GAAGD,QAAQE,OAAO;QAEpC,IAAIC,aAAaF,aAAaA,aAAaG,WAAW;YACpDT,IAAI,CAAC,UAAU,EAAEM,UAAU;YAC3B,OAAOX,aAAae,IAAI;QAC1B;QAEA,sBAAsB;QACtB,MAAMC,QAAQL,SAASM,KAAK,CAAC,KAAKC,MAAM,CAACC,SAAS,sDAAsD;;QAExG,qDAAqD;QACrD,IAAI,CAACH,MAAMI,MAAM,IAAI,CAAChB,OAAOiB,OAAO,CAACC,QAAQ,CAACN,KAAK,CAAC,EAAE,GAAG;YACvDX,IAAI,CAAC,8CAA8C,EAAED,OAAOmB,aAAa,EAAE;YAC3E,MAAMC,SAAS,IAAIC,IAAI,CAAC,CAAC,EAAErB,OAAOmB,aAAa,GAAGZ,UAAU,EAAED,QAAQgB,GAAG;YACzEF,OAAOG,MAAM,GAAGjB,QAAQE,OAAO,CAACe,MAAM,EAAC,0BAA0B;YACjE,OAAO3B,aAAa4B,OAAO,CAACJ;QAC9B;QAEA,MAAMK,SAASb,KAAK,CAAC,EAAE;QAEvB,sEAAsE;QACtE,IAAIa,WAAWzB,OAAOmB,aAAa,EAAE;YACnClB,IAAI,CAAC,6DAA6D,CAAC;YACnE,MAAMmB,SAAS,IAAIC,IAAI,MAAMT,MAAMc,KAAK,CAAC,GAAGC,IAAI,CAAC,MAAMrB,QAAQgB,GAAG;YAClEF,OAAOG,MAAM,GAAGjB,QAAQE,OAAO,CAACe,MAAM,EAAC,0BAA0B;YACjE,OAAO3B,aAAagC,QAAQ,CAACR;QAC/B;QAEA,sCAAsC;QACtC,OAAOxB,aAAae,IAAI;IAC1B;AACF;AAEA,gCAAgC;AAEhC,MAAMF,eAAe,CAACF,WAA8BV,OAAOgC,IAAI,CAAC,CAACC,OAASvB,SAASwB,UAAU,CAACD"}